var at=Object.defineProperty;var rt=(s,t,e)=>t in s?at(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>rt(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const C="https://api.quran.com/api/v4",T=[{id:"alafasy",name:"Mishary Alafasy (128kbps)",baseUrl:"https://everyayah.com/data/Alafasy_128kbps/"},{id:"husary",name:"Husary (128kbps)",baseUrl:"https://everyayah.com/data/Husary_128kbps/"}],U=T[0].id,M="Fateh Muhammad Jalandhari",nt="Shamshad Ali Khan",z="https://everyayah.com/data/translations/urdu_shamshad_ali_khan_46kbps/",it=36,ot=20,G="quran-urdu-player:settings:v3",et="quran-urdu-player:bookmarks:v1",ut="quran-urdu-player:urdu-translation-id:v1";class ct{constructor(){h(this,"cache",new Map)}async getChapters(){return(await this.fetchJson(`${C}/chapters`,"chapters")).chapters}async getTranslations(){return(await this.fetchJson(`${C}/resources/translations?language=ur`,"translations-ur")).translations}async getVersesByChapter(t,e){return this.fetchAllVerses(`verses/by_chapter/${t}`,e)}async getVersesByJuz(t,e){return this.fetchAllVerses(`verses/by_juz/${t}`,e)}async fetchAllVerses(t,e){var o;const a=[];let r=1;const n=50;for(;;){const u=new URL(`${C}/${t}`);u.searchParams.set("translations",String(e)),u.searchParams.set("fields","text_uthmani,verse_key,verse_number,chapter_id"),u.searchParams.set("per_page",String(n)),u.searchParams.set("page",String(r));const l=`${t}:${e}:${r}`,p=await this.fetchJson(u.toString(),l);a.push(...p.verses);const b=(o=p.pagination)==null?void 0:o.next_page;if(!b)break;r=b}return a}async fetchJson(t,e){if(e&&this.cache.has(e))return this.cache.get(e);const a=await fetch(t);if(!a.ok)throw new Error(`API request failed: ${a.status} ${a.statusText}`);const r=await a.json();return e&&this.cache.set(e,r),r}}function lt(s){return s.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim()}function dt(s){return(s??"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()}function ht(s){var a;let t=null,e=0;for(const r of s){const n=dt(`${r.name??""} ${r.author_name??""}`),o=n.includes("jalandh"),u=n.includes("fateh"),l=n.includes("muhammad"),p=(o?2:0)+(u?1:0)+(l?1:0);p>e&&(e=p,t=r)}return!t||e===0?{id:null,name:M}:{id:t.id,name:((a=t.translated_name)==null?void 0:a.name)??t.name}}class pt{constructor(){h(this,"queue",[]);h(this,"state",{status:"idle",currentIndex:0,phase:"arabic",isPlaying:!1});h(this,"listeners",new Set);h(this,"noticeListeners",new Set);h(this,"progressListeners",new Set);h(this,"audio",new Audio);h(this,"arabicBase","");h(this,"urduBase","");h(this,"playToken",0);h(this,"delayTimeoutId",null);h(this,"pausedPhase","idle");h(this,"repeat",!1);this.audio.preload="auto"}setSources(t,e){this.arabicBase=B(t),this.urduBase=B(e)}setRepeat(t){this.repeat=t}loadPlaylist(t){this.stopInternal(),this.queue=t,this.state={status:t.length?"stopped":"idle",currentIndex:0,phase:"arabic",isPlaying:!1},this.notify()}subscribe(t){return this.listeners.add(t),t({...this.state}),()=>this.listeners.delete(t)}onNotice(t){return this.noticeListeners.add(t),()=>this.noticeListeners.delete(t)}onProgress(t){return this.progressListeners.add(t),()=>this.progressListeners.delete(t)}getState(){return{...this.state}}getQueue(){return this.queue}play(){if(this.queue.length){if(this.state.status==="paused"){this.resume();return}this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.playCurrent()}}playFromIndex(t){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.pausedPhase="idle",this.state.currentIndex=H(t,this.queue.length),this.state.status="playing",this.state.phase="arabic",this.state.isPlaying=!0,this.notify(),this.playCurrent())}pause(){this.state.status==="playing"&&(this.state.phase==="arabic"||this.state.phase==="urdu"?(this.audio.pause(),this.pausedPhase=this.state.phase):(this.clearDelay(),this.pausedPhase="idle"),this.state.status="paused",this.state.isPlaying=!1,this.notify())}resume(){if(this.state.status==="paused"){if(this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.pausedPhase==="arabic"){this.audio.play().catch(()=>this.handleArabicError());return}if(this.pausedPhase==="urdu"){this.audio.play().catch(()=>this.handleUrduError());return}this.playCurrent()}}stop(){this.clearAudio(!0),this.clearDelay(),this.state={...this.state,status:this.queue.length?"stopped":"idle",isPlaying:!1},this.pausedPhase="idle",this.notify()}next(){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.pausedPhase="idle",this.state.currentIndex=H(this.state.currentIndex+1,this.queue.length),this.state.phase="arabic",this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.playCurrent())}prev(){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.pausedPhase="idle",this.state.currentIndex=H(this.state.currentIndex-1,this.queue.length),this.state.phase="arabic",this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.playCurrent())}restartCurrent(){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.state.phase="arabic",this.state.status==="playing"&&this.playCurrent())}prevSurah(){return this.jumpSurah(-1)}nextSurah(){return this.jumpSurah(1)}playCurrent(){if(this.state.status!=="playing")return;const t=this.queue[this.state.currentIndex];if(!t){this.stop();return}this.playToken+=1;const e=this.playToken;this.state.phase="arabic",this.notify();const a=Q(this.arabicBase,t.key);this.clearAudioHandlers(),this.audio.src=a,this.audio.onended=()=>{e===this.playToken&&this.playUrdu(t)},this.audio.onerror=()=>{e===this.playToken&&this.handleArabicError()},this.audio.onloadedmetadata=()=>{e===this.playToken&&this.emitProgress()},this.audio.ontimeupdate=()=>{e===this.playToken&&this.emitProgress()},this.audio.play().catch(()=>{e===this.playToken&&this.handleArabicError()})}playUrdu(t){if(this.state.status!=="playing")return;this.state.phase="urdu",this.notify();const e=Q(this.urduBase,t.key);this.clearAudioHandlers(),this.audio.src=e;const a=++this.playToken;this.audio.onended=()=>{a===this.playToken&&this.advance()},this.audio.onerror=()=>{a===this.playToken&&this.handleUrduError()},this.audio.onloadedmetadata=()=>{a===this.playToken&&this.emitProgress()},this.audio.ontimeupdate=()=>{a===this.playToken&&this.emitProgress()},this.audio.play().catch(()=>{a===this.playToken&&this.handleUrduError()})}handleArabicError(){const t=this.queue[this.state.currentIndex];t&&(this.emitNotice(`Arabic audio missing for ${t.surah}:${t.ayah}. Trying Urdu.`),this.playUrdu(t))}handleUrduError(){const t=this.queue[this.state.currentIndex];t&&(this.emitNotice(`Urdu audio missing for ${t.surah}:${t.ayah}. Skipping ahead.`),this.scheduleAdvance(400))}scheduleAdvance(t){this.clearDelay(),this.delayTimeoutId=window.setTimeout(()=>{this.state.status==="playing"&&this.advance()},t)}advance(){if(this.repeat){this.state.phase="arabic",this.notify(),this.playCurrent();return}const t=this.state.currentIndex+1;if(t>=this.queue.length){this.stop();return}this.state.currentIndex=t,this.state.phase="arabic",this.notify(),this.playCurrent()}stopInternal(){this.clearAudio(!0),this.clearDelay(),this.playToken+=1,this.pausedPhase="idle",this.state={status:"idle",currentIndex:0,phase:"arabic",isPlaying:!1}}clearDelay(){this.delayTimeoutId&&(window.clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null)}clearAudioHandlers(){this.audio.onended=null,this.audio.onerror=null,this.audio.ontimeupdate=null,this.audio.onloadedmetadata=null}clearAudio(t){this.audio.pause(),this.audio.currentTime=0,this.clearAudioHandlers(),t&&(this.audio.src="")}emitNotice(t){this.noticeListeners.forEach(e=>e(t))}emitProgress(){this.state.status==="playing"&&this.progressListeners.forEach(t=>t({phase:this.state.phase,currentIndex:this.state.currentIndex,currentTime:this.audio.currentTime,duration:this.audio.duration}))}notify(){const t={...this.state};this.listeners.forEach(e=>e(t))}jumpSurah(t){if(!this.queue.length)return!1;const e=this.queue[this.state.currentIndex];if(!e)return!1;const a=[];for(let o=0;o<this.queue.length;o+=1){const u=this.queue[o],l=this.queue[o-1];(!l||u.surah!==l.surah)&&a.push({surah:u.surah,index:o})}const r=a.findIndex(o=>o.surah===e.surah);if(r===-1)return!1;const n=a[r+t];return n?(this.playFromIndex(n.index),!0):!1}}function mt(s,t){return`${String(s).padStart(3,"0")}${String(t).padStart(3,"0")}`}function B(s){return s.endsWith("/")?s:`${s}/`}function Q(s,t){return`${B(s)}${t}.mp3`}function H(s,t){return t?Math.min(Math.max(s,0),t-1):0}const _={arabicFontPx:it,urduFontPx:ot,reciterId:U,theme:"warm",repeat:!1};class gt{constructor(){h(this,"settings");h(this,"listeners",new Set);this.settings=this.load()}get(){return{...this.settings}}update(t){return this.settings={...this.settings,...t},this.persist(),this.notify(),this.get()}subscribe(t){return this.listeners.add(t),t(this.get()),()=>this.listeners.delete(t)}notify(){const t=this.get();this.listeners.forEach(e=>e(t))}load(){try{const t=localStorage.getItem(G);if(!t)return{..._};const e=JSON.parse(t);return{..._,...e}}catch{return{..._}}}persist(){localStorage.setItem(G,JSON.stringify(this.settings))}}function ft(s){let t=s;const e=new Set,a=()=>t,r=u=>{t=u,e.forEach(l=>l(t))};return{getState:a,setState:r,update:u=>{r(u(t))},subscribe:u=>(e.add(u),u(t),()=>e.delete(u))}}function st(s){const t=s.mode==="juz"?`j${s.juzNumber??0}`:"s";return`${s.mode}-${t}-${s.surahNumber}-${s.ayahNumber}`}function yt(){try{const s=localStorage.getItem(et);if(!s)return[];const t=JSON.parse(s);return Array.isArray(t)?t.filter(e=>Number.isFinite(e.timestamp)):[]}catch{return[]}}function bt(s){localStorage.setItem(et,JSON.stringify(s))}function vt(s,t){const e=st(t);return s.find(n=>n.id===e)?s.filter(n=>n.id!==e):[{id:e,mode:t.mode,surahNumber:t.surahNumber,ayahNumber:t.ayahNumber,juzNumber:t.juzNumber,timestamp:Date.now()},...s]}function St(s,t){const e=st(t);return s.some(a=>a.id===e)}function $t(s){return[...s].sort((t,e)=>e.timestamp-t.timestamp)}const c={modeSurah:document.getElementById("modeSurah"),modeJuz:document.getElementById("modeJuz"),listHeader:document.getElementById("listHeader"),listContainer:document.getElementById("listContainer"),bookmarkList:document.getElementById("bookmarkList"),notice:document.getElementById("notice"),toastHost:document.getElementById("toastHost"),selectionHeader:document.getElementById("selectionHeader"),versesContainer:document.getElementById("versesContainer"),playerBar:document.getElementById("playerBar"),settingsDrawer:document.getElementById("settingsDrawer"),settingsOverlay:document.getElementById("settingsOverlay"),settingsContent:document.getElementById("settingsContent")};let x=-1,k=null,L=null,F=!1,E=null,m=-1,g=-1,I=-1;function xt(){}function f(s){const t=s.playbackState.status==="playing",e=t?"Pause":"Play",a=t?"pause":"play",r=s.settings.repeat?"active":"";if(!s.playerVisible){c.playerBar.classList.add("hidden"),document.body.classList.remove("player-visible"),c.playerBar.innerHTML="";return}c.playerBar.classList.remove("hidden"),document.body.classList.add("player-visible");const n=kt(s);c.playerBar.innerHTML=`
    <div class="player-info">
      <span class="player-title">Now Playing</span>
      <span class="player-sub">${n}</span>
    </div>

    <div class="player-controls">
      <button class="player-button" data-action="${a}">${e}</button>
      <button class="player-button" data-action="prev-ayah">Prev Ayah</button>
      <button class="player-button" data-action="next-ayah">Next Ayah</button>
      <button class="player-button" data-action="prev-surah">Prev Surah</button>
      <button class="player-button" data-action="next-surah">Next Surah</button>
      <button class="player-button ${r}" data-action="toggle-repeat">Repeat</button>
      <button class="player-button danger" data-action="stop">Stop</button>
    </div>

    <div class="player-actions">
      <button class="icon-button" data-action="toggle-settings" aria-label="Settings">
        ⚙
      </button>
    </div>
  `}function P(s){c.modeSurah.classList.toggle("active",s.currentMode==="surah"),c.modeJuz.classList.toggle("active",s.currentMode==="juz"),s.loading?(c.listHeader.textContent="Loading...",c.listContainer.innerHTML=""):s.error?(c.listHeader.textContent="Error",c.listContainer.innerHTML=`<p class="empty">${s.error}</p>`):s.currentMode==="surah"?(c.listHeader.textContent=`Surahs (${s.chapters.length})`,c.listContainer.innerHTML=s.chapters.map(t=>`
          <div class="list-item ${s.currentSelection===t.id?"active":""}" data-action="select-selection" data-mode="surah" data-number="${t.id}">
            <div class="list-meta">
              <div class="list-title">${t.id}. ${t.name_simple}</div>
              <div class="list-sub">${t.name_arabic} - ${t.verses_count} ayahs</div>
            </div>
            <button data-action="play-selection" data-mode="surah" data-number="${t.id}">Play</button>
          </div>
        `).join("")):(c.listHeader.textContent="Juz (30)",c.listContainer.innerHTML=Array.from({length:30},(t,e)=>{const a=e+1;return`
        <div class="list-item ${s.currentSelection===a?"active":""}" data-action="select-selection" data-mode="juz" data-number="${a}">
          <div class="list-meta">
            <div class="list-title">Juz ${a}</div>
            <div class="list-sub">Para ${a}</div>
          </div>
          <button data-action="play-selection" data-mode="juz" data-number="${a}">Play</button>
        </div>
      `}).join("")),Tt(s.bookmarks)}function Tt(s){const t=$t(s);if(!t.length){c.bookmarkList.innerHTML='<p class="empty">No bookmarks yet.</p>';return}c.bookmarkList.innerHTML=t.map(e=>{const a=e.mode==="surah"?`Surah ${e.surahNumber} - Ayah ${e.ayahNumber}`:`Juz ${e.juzNumber??""} - ${e.surahNumber}:${e.ayahNumber}`;return`
        <button class="bookmark-item" data-action="bookmark-jump" data-mode="${e.mode}" data-surah="${e.surahNumber}" data-ayah="${e.ayahNumber}" data-juz="${e.juzNumber??""}">
          <span>${a}</span>
          <span class="bookmark-time">${Ht(e.timestamp)}</span>
        </button>
      `}).join("")}function q(s){if(!s.verses.length){Y(s),c.versesContainer.innerHTML='<p class="empty">Select a Surah or Juz to begin.</p>',x=-1,k=null,L=null,m=-1,g=-1,I=-1;return}Y(s);const t=s.playbackState.currentIndex,e=[];let a=null;s.verses.forEach((r,n)=>{s.currentMode==="juz"&&a!==null&&r.surah!==a&&e.push(Nt(s,r.surah)),(a===null||r.surah!==a)&&(a=r.surah),e.push(wt(r,n,s,t))}),c.versesContainer.innerHTML=e.join(""),x=-1,k=null,L=null,m=-1,g=-1,I=-1}function w(s){const t=T.map(e=>{const a=e.id===s.settings.reciterId?"selected":"";return`<option value="${e.id}" ${a}>${e.name}</option>`}).join("");c.settingsContent.innerHTML=`
    <div class="settings-section">
      <h4>Audio</h4>
      <div class="settings-row">
        <label>Reciter</label>
        <select data-action="reciter-select">${t}</select>
      </div>
      <div class="settings-row">
        <label>Urdu translation</label>
        <span>${M}</span>
      </div>
      <div class="settings-row">
        <label>Voice</label>
        <span>${nt}</span>
      </div>
    </div>

    <div class="settings-section">
      <h4>Typography</h4>
      <div class="settings-row">
        <label>Arabic size</label>
        <div class="stepper">
          <button data-action="arabic-dec">-</button>
          <span>${s.settings.arabicFontPx}px</span>
          <button data-action="arabic-inc">+</button>
        </div>
      </div>
      <div class="settings-row">
        <label>Urdu size</label>
        <div class="stepper">
          <button data-action="urdu-dec">-</button>
          <span>${s.settings.urduFontPx}px</span>
          <button data-action="urdu-inc">+</button>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <h4>Theme</h4>
      <div class="settings-row">
        <label>Mode</label>
        <button class="toggle-pill" data-action="toggle-theme">${s.settings.theme==="warm"?"Warm":"Dark"}</button>
      </div>
    </div>
  `,s.settingsOpen?(c.settingsDrawer.classList.remove("hidden"),c.settingsOverlay.classList.remove("hidden")):(c.settingsDrawer.classList.add("hidden"),c.settingsOverlay.classList.add("hidden"))}function j(s){const t=s.playbackState.currentIndex,e=s.playbackState.phase,a=s.playbackState.status==="playing",r=L!==s.playbackState.status,n=x!==t,o=k!==e;if(!(!n&&!o&&!r)){if(n){const u=c.versesContainer.querySelector(`[data-verse-index="${x}"]`);u instanceof HTMLElement&&(u.classList.remove("active"),v(u));const l=c.versesContainer.querySelector(`[data-verse-index="${t}"]`);l instanceof HTMLElement&&(l.classList.add("active"),v(l)),x=t,m=-1,g=-1,I=t}else{const u=c.versesContainer.querySelector(`[data-verse-index="${t}"]`);u instanceof HTMLElement&&(o&&(v(u),m=-1,g=-1),r&&!a&&v(u),r&&a&&(v(u),m=-1,g=-1))}k=e,L=s.playbackState.status,n&&a&&Lt(t)}}function It(s,t){if(s.playbackState.status!=="playing")return;const e=t.currentIndex,a=c.versesContainer.querySelector(`[data-verse-index="${e}"]`);if(!(a instanceof HTMLElement))return;const r=Mt(a,t.phase);if(!r)return;const n=Number.isFinite(t.duration)&&t.duration>0?t.duration:0,o=n?Math.floor(t.currentTime/n*r):0,u=Math.min(Math.max(o,0),r-1);At(a,t.phase,u,e)}function S(s){if(s.error){c.notice.innerHTML=`<div class="notice-banner error">${s.error}</div>`;return}c.notice.innerHTML=""}function Pt(s){if(!s)return;const t=document.createElement("div");t.className="toast",t.textContent=s,c.toastHost.appendChild(t),window.setTimeout(()=>{t.classList.add("hide"),window.setTimeout(()=>t.remove(),300)},2200)}function wt(s,t,e,a){const r=t===a?"active":"",n=e.currentMode==="surah"?`Ayah ${s.ayah}`:`Ayah ${s.surah}:${s.ayah}`,o=St(e.bookmarks,{mode:e.currentMode,surahNumber:s.surah,ayahNumber:s.ayah,juzNumber:e.currentMode==="juz"?e.currentSelection??void 0:void 0}),u=Z(s.arabicText),l=Z(s.urduText),p=`ayah-${tt(s.surah)}${tt(s.ayah)}`;return`
    <div class="verse ${r}" id="${p}" data-verse-index="${t}" data-arabic-words="${u.count}" data-urdu-words="${l.count}">
      <div class="verse-actions">
        <button class="icon-button" data-action="play-ayah" data-index="${t}" aria-label="Play ayah">
          <span class="icon-play"></span>
        </button>
        <button class="bookmark-button ${o?"active":""}" data-action="toggle-bookmark" data-index="${t}">
          ${o?"Bookmarked":"Bookmark"}
        </button>
      </div>
      <div class="verse-meta">
        <span>${n}</span>
        <span class="playing-indicator">Playing</span>
      </div>
      <div class="verse-arabic" dir="rtl" lang="ar">${u.html}</div>
      <div class="verse-urdu" dir="rtl" lang="ur">${l.html}</div>
    </div>
  `}function Y(s){if(!s.verses.length){c.selectionHeader.innerHTML="";return}if(s.currentMode==="surah"){const r=s.chapters.find(u=>u.id===s.currentSelection),n=r?`Surah ${r.name_simple}`:`Surah ${s.currentSelection??""}`,o=r?`${r.verses_count} ayahs`:`${s.verses.length} ayahs`;c.selectionHeader.innerHTML=`
      <div class="selection-card">
        <h3>${n}</h3>
        <p>${o}</p>
      </div>
    `;return}const t=s.verses[0],e=s.verses[s.verses.length-1],a=t&&e?`${t.surah}:${t.ayah} – ${e.surah}:${e.ayah}`:"";c.selectionHeader.innerHTML=`
    <div class="selection-card">
      <h3>Juz ${s.currentSelection??""}</h3>
      <p>${a}</p>
    </div>
  `}function Nt(s,t){const e=s.chapters.find(n=>n.id===t),a=e?`Now entering Surah ${e.name_simple}`:`Now entering Surah ${t}`,r=e?`${e.verses_count} ayahs`:"";return`
    <div class="surah-separator">
      <div>${a}</div>
      <span>${r}</span>
    </div>
  `}function kt(s){if(!s.verses.length)return"No selection";const t=s.verses[s.playbackState.currentIndex];if(!t)return"No selection";if(s.currentMode==="surah"){const e=s.chapters.find(a=>a.id===t.surah);return`${(e==null?void 0:e.name_simple)??`Surah ${t.surah}`} • Ayah ${t.ayah}`}return`Juz ${s.currentSelection??""} • ${t.surah}:${t.ayah}`}function Lt(s){const t=c.versesContainer.querySelector(`[data-verse-index="${s}"]`);if(!(t instanceof HTMLElement))return;const e=c.versesContainer,a=e.scrollHeight>e.clientHeight+1,r=()=>{E=window.setTimeout(()=>{F=!1},600)};if(F=!0,E&&window.clearTimeout(E),a){const b=Math.round(e.clientHeight*.15),N=t.offsetTop-b;e.scrollTo({top:Math.max(N,0),behavior:"smooth"}),r();return}const n=document.body.classList.contains("player-visible")&&Number.parseInt(getComputedStyle(document.documentElement).getPropertyValue("--player-bar-height"),10)||0,o=Math.max(window.innerHeight-n,0),u=Math.round(o*.15),l=t.getBoundingClientRect(),p=window.scrollY+l.top-u;window.scrollTo({top:Math.max(p,0),behavior:"smooth"}),r()}function At(s,t,e,a){if(I!==a&&(v(s),m=-1,g=-1,I=a),t==="arabic"){if(e===m)return;X(s,".verse-arabic",m,e),m=e;return}if(t==="urdu"){if(e===g)return;X(s,".verse-urdu",g,e),g=e}}function X(s,t,e,a){const r=s.querySelector(t);if(!(r instanceof HTMLElement))return;if(e>=0){const o=r.querySelector(`[data-word-index="${e}"]`);o instanceof HTMLElement&&o.classList.remove("word-active")}const n=r.querySelector(`[data-word-index="${a}"]`);n instanceof HTMLElement&&n.classList.add("word-active")}function v(s){s.querySelectorAll(".word-active").forEach(e=>e.classList.remove("word-active"))}function Mt(s,t){const e=t==="arabic"?s.dataset.arabicWords:s.dataset.urduWords,a=e?Number.parseInt(e,10):0;return Number.isFinite(a)?a:0}function Z(s){const t=s.split(/(\s+)/);let e=0;return{html:t.map(r=>{if(!r.trim())return r;const n=Ct(r),o=`<span class="word" data-word-index="${e}">${n}</span>`;return e+=1,o}).join(""),count:e}}function Ct(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")}function tt(s){return String(s).padStart(3,"0")}function Ht(s){try{return new Date(s).toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return""}}const A=new ct,d=new pt,O=new gt,i=ft({currentMode:"surah",currentSelection:null,verses:[],playbackState:d.getState(),settings:O.get(),bookmarks:yt(),chapters:[],translatorName:M,translationId:null,playerVisible:!1,settingsOpen:!1,loading:!0,error:""});function R(s,t){document.documentElement.style.setProperty("--arabic-size",`${s}px`),document.documentElement.style.setProperty("--urdu-size",`${t}px`)}function D(s){document.documentElement.dataset.theme=s}function J(s){var t;return((t=T.find(e=>e.id===s))==null?void 0:t.baseUrl)??T[0].baseUrl}async function $(s,t,e,a=!1){a&&(i.update(n=>({...n,playerVisible:!0})),f(i.getState()));const r=i.getState().translationId;if(!r){i.update(n=>({...n,error:"Urdu translation not found."})),S(i.getState());return}i.update(n=>({...n,loading:!0,error:""})),S(i.getState()),P(i.getState());try{let n=[];s==="surah"?n=await A.getVersesByChapter(t,r):n=await A.getVersesByJuz(t,r);const o=n.map(l=>{var W,K;const[p,b]=l.verse_key.split(":"),N=Number(p),V=Number(b);return{surah:N,ayah:V,verseKey:l.verse_key,key:mt(N,V),arabicText:l.text_uthmani,urduText:lt(((K=(W=l.translations)==null?void 0:W[0])==null?void 0:K.text)??"")}}),u=e?Math.max(o.findIndex(l=>l.surah===e.surah&&l.ayah===e.ayah),0):0;i.update(l=>({...l,currentMode:s,currentSelection:t,verses:o,loading:!1,error:""})),d.loadPlaylist(o),d.setSources(J(i.getState().settings.reciterId),z),a&&o.length&&d.playFromIndex(u)}catch(n){const o=n instanceof Error?n.message:"Failed to load selection.";i.update(u=>({...u,loading:!1,error:o,playerVisible:a?!1:u.playerVisible})),S(i.getState()),f(i.getState())}finally{P(i.getState()),q(i.getState()),j(i.getState())}}function y(s){const t=O.update(s);i.update(e=>({...e,settings:t})),R(t.arabicFontPx,t.urduFontPx),D(t.theme),d.setRepeat(t.repeat),f(i.getState()),w(i.getState())}function _t(s){const e=s.target.closest("[data-action]"),a=e==null?void 0:e.dataset.action;if(a){if(a==="switch-mode"){const r=e==null?void 0:e.dataset.mode;r&&r!==i.getState().currentMode&&(i.update(n=>({...n,currentMode:r})),P(i.getState()));return}if(a==="select-selection"){const r=(e==null?void 0:e.dataset.mode)??"surah",n=Number(e==null?void 0:e.dataset.number);if(!Number.isFinite(n))return;d.stop(),i.update(o=>({...o,playerVisible:!1})),f(i.getState()),$(r,n,void 0,!1);return}if(a==="play-selection"){const r=(e==null?void 0:e.dataset.mode)??"surah",n=Number(e==null?void 0:e.dataset.number);if(!Number.isFinite(n))return;$(r,n,void 0,!0);return}if(a==="play"){d.play();return}if(a==="pause"){d.pause();return}if(a==="stop"){d.stop(),i.update(r=>({...r,playerVisible:!1})),f(i.getState());return}if(a==="next-ayah"){d.next();return}if(a==="prev-ayah"){d.prev();return}if(a==="prev-surah"){const r=i.getState();if(r.currentMode==="surah"){const n=(r.currentSelection??1)-1;n>=1&&$("surah",n,void 0,!0);return}d.prevSurah();return}if(a==="next-surah"){const r=i.getState();if(r.currentMode==="surah"){const n=(r.currentSelection??1)+1;n<=r.chapters.length&&$("surah",n,void 0,!0);return}d.nextSurah();return}if(a==="toggle-repeat"){y({repeat:!i.getState().settings.repeat});return}if(a==="arabic-inc"){y({arabicFontPx:Math.min(i.getState().settings.arabicFontPx+2,52)});return}if(a==="arabic-dec"){y({arabicFontPx:Math.max(i.getState().settings.arabicFontPx-2,24)});return}if(a==="urdu-inc"){y({urduFontPx:Math.min(i.getState().settings.urduFontPx+2,28)});return}if(a==="urdu-dec"){y({urduFontPx:Math.max(i.getState().settings.urduFontPx-2,14)});return}if(a==="play-ayah"){const r=Number(e==null?void 0:e.dataset.index);if(!Number.isFinite(r))return;d.stop(),d.loadPlaylist(i.getState().verses),d.setSources(J(i.getState().settings.reciterId),z),d.playFromIndex(r),i.update(n=>({...n,playerVisible:!0})),f(i.getState());return}if(a==="toggle-bookmark"){const r=Number(e==null?void 0:e.dataset.index);if(!Number.isFinite(r))return;const n=i.getState().verses[r];if(!n)return;const o=i.getState().currentMode,u=vt(i.getState().bookmarks,{mode:o,surahNumber:n.surah,ayahNumber:n.ayah,juzNumber:o==="juz"?i.getState().currentSelection??void 0:void 0});bt(u),i.update(l=>({...l,bookmarks:u})),P(i.getState()),q(i.getState()),j(i.getState());return}if(a==="bookmark-jump"){const r=(e==null?void 0:e.dataset.mode)??"surah",n=Number(e==null?void 0:e.dataset.surah),o=Number(e==null?void 0:e.dataset.ayah),u=Number(e==null?void 0:e.dataset.juz);if(!Number.isFinite(n)||!Number.isFinite(o))return;const l=r==="surah"?n:u;if(!Number.isFinite(l))return;$(r,l,{surah:n,ayah:o},!0);return}if(a==="toggle-settings"){i.update(r=>({...r,settingsOpen:!r.settingsOpen})),w(i.getState());return}if(a==="close-settings"){i.update(r=>({...r,settingsOpen:!1})),w(i.getState());return}if(a==="toggle-theme"){const r=i.getState().settings.theme==="warm"?"dark":"warm";y({theme:r});return}}}function Et(s){const t=s.target;if(!t)return;const e=t.dataset.action;if(e&&e==="reciter-select"){const a=t.value||U;y({reciterId:a}),d.setSources(J(a),z),d.restartCurrent()}}async function Bt(){R(i.getState().settings.arabicFontPx,i.getState().settings.urduFontPx),D(i.getState().settings.theme),d.setRepeat(i.getState().settings.repeat);const s=i.getState().settings.reciterId;T.some(t=>t.id===s)||y({reciterId:U});try{const[t,e]=await Promise.all([A.getChapters(),A.getTranslations()]),a=ht(e);a.id&&localStorage.setItem(ut,String(a.id)),i.update(r=>({...r,chapters:t,translatorName:M,translationId:a.id??null,loading:!1,error:a.id?"":"Urdu translation not found (Jalandhari)."})),S(i.getState())}catch(t){const e=t instanceof Error?t.message:"Failed to load Quran data.";i.update(a=>({...a,loading:!1,error:e})),S(i.getState())}finally{P(i.getState()),f(i.getState()),w(i.getState()),q(i.getState()),S(i.getState())}}d.subscribe(s=>{i.update(t=>({...t,playbackState:s})),f(i.getState()),j(i.getState())});d.onNotice(s=>{Pt(s)});d.onProgress(s=>{It(i.getState(),{phase:s.phase,currentIndex:s.currentIndex,currentTime:s.currentTime,duration:s.duration})});O.subscribe(s=>{i.update(t=>({...t,settings:s})),R(s.arabicFontPx,s.urduFontPx),D(s.theme),d.setRepeat(s.repeat),f(i.getState()),w(i.getState())});window.addEventListener("click",_t);window.addEventListener("change",Et);window.addEventListener("scroll",xt,{passive:!0});window.addEventListener("beforeunload",()=>d.stop());Bt();
