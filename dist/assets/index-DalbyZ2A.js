var oe=Object.defineProperty;var ue=(t,e,a)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var g=(t,e,a)=>ue(t,typeof e!="symbol"?e+"":e,a);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const _="https://api.quran.com/api/v4",I=[{id:"alafasy",name:"Mishary Alafasy (128kbps)",baseUrl:"https://everyayah.com/data/Alafasy_128kbps/"},{id:"husary",name:"Husary (128kbps)",baseUrl:"https://everyayah.com/data/Husary_128kbps/"}],j=I[0].id,C="Fateh Muhammad Jalandhari",ce="Shamshad Ali Khan",D="https://everyayah.com/data/translations/urdu_shamshad_ali_khan_46kbps/",le=36,de=20,ee="quran-urdu-player:settings:v3",ne="quran-urdu-player:bookmarks:v1",he="quran-urdu-player:urdu-translation-id:v1";class pe{constructor(){g(this,"cache",new Map)}async getChapters(){return(await this.fetchJson(`${_}/chapters`,"chapters")).chapters}async getTranslations(){return(await this.fetchJson(`${_}/resources/translations?language=ur`,"translations-ur")).translations}async getVersesByChapter(e,a){return this.fetchAllVerses(`verses/by_chapter/${e}`,a)}async getVersesByJuz(e,a){return this.fetchAllVerses(`verses/by_juz/${e}`,a)}async fetchAllVerses(e,a){var u;const r=[];let s=1;const i=50;for(;;){const o=new URL(`${_}/${e}`);o.searchParams.set("translations",String(a)),o.searchParams.set("fields","text_uthmani,verse_key,verse_number,chapter_id"),o.searchParams.set("per_page",String(i)),o.searchParams.set("page",String(s));const d=`${e}:${a}:${s}`,c=await this.fetchJson(o.toString(),d);r.push(...c.verses);const p=(u=c.pagination)==null?void 0:u.next_page;if(!p)break;s=p}return r}async fetchJson(e,a){if(a&&this.cache.has(a))return this.cache.get(a);const r=await fetch(e);if(!r.ok)throw new Error(`API request failed: ${r.status} ${r.statusText}`);const s=await r.json();return a&&this.cache.set(a,s),s}}function ge(t){return t.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim()}function ye(t){return(t??"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()}function me(t){var r;let e=null,a=0;for(const s of t){const i=ye(`${s.name??""} ${s.author_name??""}`),u=i.includes("jalandh"),o=i.includes("fateh"),d=i.includes("muhammad"),c=(u?2:0)+(o?1:0)+(d?1:0);c>a&&(a=c,e=s)}return!e||a===0?{id:null,name:C}:{id:e.id,name:((r=e.translated_name)==null?void 0:r.name)??e.name}}class fe{constructor(){g(this,"queue",[]);g(this,"state",{status:"idle",currentIndex:0,phase:"arabic",isPlaying:!1});g(this,"listeners",new Set);g(this,"noticeListeners",new Set);g(this,"progressListeners",new Set);g(this,"audio",new Audio);g(this,"arabicBase","");g(this,"urduBase","");g(this,"playToken",0);g(this,"delayTimeoutId",null);g(this,"pausedPhase","idle");g(this,"repeat",!1);g(this,"urduVoiceEnabled",!0);g(this,"playbackRate",1);this.audio.preload="auto"}setSources(e,a){this.arabicBase=z(e),this.urduBase=z(a)}setRepeat(e){this.repeat=e}setUrduVoiceEnabled(e){this.urduVoiceEnabled=e}setPlaybackRate(e){const a=Number.isFinite(e)?Math.min(Math.max(e,.25),2):1;this.playbackRate=a,this.audio.playbackRate=a}loadPlaylist(e){this.stopInternal(),this.queue=e,this.state={status:e.length?"stopped":"idle",currentIndex:0,phase:"arabic",isPlaying:!1},this.notify()}subscribe(e){return this.listeners.add(e),e({...this.state}),()=>this.listeners.delete(e)}onNotice(e){return this.noticeListeners.add(e),()=>this.noticeListeners.delete(e)}onProgress(e){return this.progressListeners.add(e),()=>this.progressListeners.delete(e)}getState(){return{...this.state}}getQueue(){return this.queue}play(){if(this.queue.length){if(this.state.status==="paused"){this.resume();return}this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.playCurrent()}}playFromIndex(e){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.pausedPhase="idle",this.state.currentIndex=B(e,this.queue.length),this.state.status="playing",this.state.phase="arabic",this.state.isPlaying=!0,this.notify(),this.playCurrent())}pause(){this.state.status==="playing"&&(this.state.phase==="arabic"||this.state.phase==="urdu"?(this.audio.pause(),this.pausedPhase=this.state.phase):(this.clearDelay(),this.pausedPhase="idle"),this.state.status="paused",this.state.isPlaying=!1,this.notify())}resume(){if(this.state.status==="paused"){if(this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.pausedPhase==="arabic"){this.audio.play().catch(()=>this.handleArabicError());return}if(this.pausedPhase==="urdu"){this.audio.play().catch(()=>this.handleUrduError());return}this.playCurrent()}}stop(){this.clearAudio(!0),this.clearDelay(),this.state={...this.state,status:this.queue.length?"stopped":"idle",isPlaying:!1},this.pausedPhase="idle",this.notify()}prevSurah(){return this.jumpSurah(-1)}nextSurah(){return this.jumpSurah(1)}next(){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.pausedPhase="idle",this.state.currentIndex=B(this.state.currentIndex+1,this.queue.length),this.state.phase="arabic",this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.playCurrent())}prev(){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.pausedPhase="idle",this.state.currentIndex=B(this.state.currentIndex-1,this.queue.length),this.state.phase="arabic",this.state.status="playing",this.state.isPlaying=!0,this.notify(),this.playCurrent())}restartCurrent(){this.queue.length&&(this.clearAudio(!0),this.clearDelay(),this.state.phase="arabic",this.state.status==="playing"&&this.playCurrent())}playCurrent(){if(this.state.status!=="playing")return;const e=this.queue[this.state.currentIndex];if(!e){this.stop();return}this.playToken+=1;const a=this.playToken;this.state.phase="arabic",this.notify();const r=te(this.arabicBase,e.key);this.clearAudioHandlers(),this.audio.src=r,this.audio.playbackRate=this.playbackRate,this.audio.onended=()=>{if(a===this.playToken){if(!this.urduVoiceEnabled){this.advance();return}this.playUrdu(e)}},this.audio.onerror=()=>{a===this.playToken&&this.handleArabicError()},this.audio.onloadedmetadata=()=>{a===this.playToken&&this.emitProgress()},this.audio.ontimeupdate=()=>{a===this.playToken&&this.emitProgress()},this.audio.play().catch(()=>{a===this.playToken&&this.handleArabicError()})}playUrdu(e){if(this.state.status!=="playing")return;this.state.phase="urdu",this.notify();const a=te(this.urduBase,e.key);this.clearAudioHandlers(),this.audio.src=a,this.audio.playbackRate=this.playbackRate;const r=++this.playToken;this.audio.onended=()=>{r===this.playToken&&this.advance()},this.audio.onerror=()=>{r===this.playToken&&this.handleUrduError()},this.audio.onloadedmetadata=()=>{r===this.playToken&&this.emitProgress()},this.audio.ontimeupdate=()=>{r===this.playToken&&this.emitProgress()},this.audio.play().catch(()=>{r===this.playToken&&this.handleUrduError()})}handleArabicError(){const e=this.queue[this.state.currentIndex];if(e){if(this.emitNotice(`Arabic audio missing for ${e.surah}:${e.ayah}. Trying Urdu.`),!this.urduVoiceEnabled){this.scheduleAdvance(400);return}this.playUrdu(e)}}handleUrduError(){const e=this.queue[this.state.currentIndex];e&&(this.emitNotice(`Urdu audio missing for ${e.surah}:${e.ayah}. Skipping ahead.`),this.scheduleAdvance(400))}scheduleAdvance(e){this.clearDelay(),this.delayTimeoutId=window.setTimeout(()=>{this.state.status==="playing"&&this.advance()},e)}advance(){if(this.repeat){this.state.phase="arabic",this.notify(),this.playCurrent();return}const e=this.state.currentIndex+1;if(e>=this.queue.length){this.stop();return}this.state.currentIndex=e,this.state.phase="arabic",this.notify(),this.playCurrent()}stopInternal(){this.clearAudio(!0),this.clearDelay(),this.playToken+=1,this.pausedPhase="idle",this.state={status:"idle",currentIndex:0,phase:"arabic",isPlaying:!1}}clearDelay(){this.delayTimeoutId&&(window.clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null)}clearAudioHandlers(){this.audio.onended=null,this.audio.onerror=null,this.audio.ontimeupdate=null,this.audio.onloadedmetadata=null}clearAudio(e){this.audio.pause(),this.audio.currentTime=0,this.clearAudioHandlers(),e&&(this.audio.src="")}jumpSurah(e){if(!this.queue.length)return!1;const a=this.queue[this.state.currentIndex];if(!a)return!1;const r=[];for(let u=0;u<this.queue.length;u+=1){const o=this.queue[u],d=this.queue[u-1];(!d||o.surah!==d.surah)&&r.push({surah:o.surah,index:u})}const s=r.findIndex(u=>u.surah===a.surah);if(s===-1)return!1;const i=r[s+e];return i?(this.playFromIndex(i.index),!0):!1}emitNotice(e){this.noticeListeners.forEach(a=>a(e))}emitProgress(){this.state.status==="playing"&&this.progressListeners.forEach(e=>e({phase:this.state.phase,currentIndex:this.state.currentIndex,currentTime:this.audio.currentTime,duration:this.audio.duration}))}notify(){const e={...this.state};this.listeners.forEach(a=>a(e))}}function be(t,e){return`${String(t).padStart(3,"0")}${String(e).padStart(3,"0")}`}function z(t){return t.endsWith("/")?t:`${t}/`}function te(t,e){return`${z(t)}${e}.mp3`}function B(t,e){return e?Math.min(Math.max(t,0),e-1):0}const F={arabicFontPx:le,urduFontPx:de,reciterId:j,theme:"warm",repeat:!1,urduVoiceEnabled:!0,playbackSpeed:1};class ve{constructor(){g(this,"settings");g(this,"listeners",new Set);this.settings=this.load()}get(){return{...this.settings}}update(e){return this.settings={...this.settings,...e},this.persist(),this.notify(),this.get()}subscribe(e){return this.listeners.add(e),e(this.get()),()=>this.listeners.delete(e)}notify(){const e=this.get();this.listeners.forEach(a=>a(e))}load(){try{const e=localStorage.getItem(ee);if(!e)return{...F};const a=JSON.parse(e);return{...F,...a}}catch{return{...F}}}persist(){localStorage.setItem(ee,JSON.stringify(this.settings))}}function Se(t){let e=t;const a=new Set,r=()=>e,s=o=>{e=o,a.forEach(d=>d(e))};return{getState:r,setState:s,update:o=>{s(o(e))},subscribe:o=>(a.add(o),o(e),()=>a.delete(o))}}function ie(t){const e=t.mode==="juz"?`j${t.juzNumber??0}`:"s";return`${t.mode}-${e}-${t.surahNumber}-${t.ayahNumber}`}function $e(){try{const t=localStorage.getItem(ne);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e.filter(a=>Number.isFinite(a.timestamp)):[]}catch{return[]}}function xe(t){localStorage.setItem(ne,JSON.stringify(t))}function ke(t,e){const a=ie(e);return t.find(i=>i.id===a)?t.filter(i=>i.id!==a):[{id:a,mode:e.mode,surahNumber:e.surahNumber,ayahNumber:e.ayahNumber,juzNumber:e.juzNumber,timestamp:Date.now()},...t]}function Te(t,e){const a=ie(e);return t.some(r=>r.id===a)}function Pe(t){return[...t].sort((e,a)=>a.timestamp-e.timestamp)}const l={modeSurah:document.getElementById("modeSurah"),modeJuz:document.getElementById("modeJuz"),listHeader:document.getElementById("listHeader"),listContainer:document.getElementById("listContainer"),bookmarkList:document.getElementById("bookmarkList"),notice:document.getElementById("notice"),toastHost:document.getElementById("toastHost"),selectionHeader:document.getElementById("selectionHeader"),versesContainer:document.getElementById("versesContainer"),playerBar:document.getElementById("playerBar"),settingsDrawer:document.getElementById("settingsDrawer"),settingsOverlay:document.getElementById("settingsOverlay"),settingsContent:document.getElementById("settingsContent")};let $=-1,N=null,A=null,R=!1,U=null,b=-1,v=-1,P=-1;function Ie(){}function y(t){const e=t.playbackState.status==="playing",a=e?"Pause":"Play",r=e?"pause":"play",s=t.settings.repeat?"active":"",i=Ce(t.settings.playbackSpeed),u=[.25,.5,.75,1,1.25,1.5,1.75,2];l.playerBar.classList.remove("hidden"),document.body.classList.add("player-visible");const o=t.verses.length>0,d=o?He(t):"Select a Surah/Juz/Ayah to play",c=o?"":"disabled";l.playerBar.innerHTML=`
    <div class="player-info">
      <span class="player-title">Now Playing</span>
      <span class="player-sub">${d}</span>
    </div>

    <div class="player-controls">
      <button class="player-button" data-action="${r}" ${c}>${a}</button>
      <button class="player-button" data-action="prev-ayah" ${c}>Prev Ayah</button>
      <button class="player-button" data-action="next-ayah" ${c}>Next Ayah</button>
      <button class="player-button" data-action="prev-surah" ${c}>Prev Surah</button>
      <button class="player-button" data-action="next-surah" ${c}>Next Surah</button>
      <button class="player-button ${s}" data-action="toggle-repeat" ${c}>Repeat</button>
      <button class="player-button danger" data-action="stop" ${c}>Stop</button>
    </div>

    <div class="player-actions">
      <div class="speed-control">
        <button class="player-button speed-button" data-action="toggle-speed-menu">${i}</button>
        <div class="speed-popover ${t.speedMenuOpen?"open":""}">
          ${u.map(p=>{const m=Number(p)===Number(t.settings.playbackSpeed),L=p===1?"1x (Normal)":`${p}x`;return`
                <button class="speed-option ${m?"selected":""}" data-action="set-speed" data-speed="${p}">
                  <span class="check">${m?"✓":""}</span>
                  <span>${L}</span>
                </button>
              `}).join("")}
        </div>
      </div>
      <button class="icon-button" data-action="toggle-settings" aria-label="Settings">
        ⚙
      </button>
    </div>
  `}function w(t){l.modeSurah.classList.toggle("active",t.currentMode==="surah"),l.modeJuz.classList.toggle("active",t.currentMode==="juz"),t.loading?(l.listHeader.textContent="Loading...",l.listContainer.innerHTML=""):t.error?(l.listHeader.textContent="Error",l.listContainer.innerHTML=`<p class="empty">${t.error}</p>`):t.currentMode==="surah"?(l.listHeader.textContent=`Surahs (${t.chapters.length})`,l.listContainer.innerHTML=t.chapters.map(e=>`
          <div class="list-item ${t.currentSelection===e.id?"active":""}" data-action="select-selection" data-mode="surah" data-number="${e.id}">
            <div class="list-meta">
              <div class="list-title">${e.id}. ${e.name_simple}</div>
              <div class="list-sub">${e.name_arabic} - ${e.verses_count} ayahs</div>
            </div>
            <button data-action="play-selection" data-mode="surah" data-number="${e.id}">Play</button>
          </div>
        `).join("")):(l.listHeader.textContent="Juz (30)",l.listContainer.innerHTML=Array.from({length:30},(e,a)=>{const r=a+1;return`
        <div class="list-item ${t.currentSelection===r?"active":""}" data-action="select-selection" data-mode="juz" data-number="${r}">
          <div class="list-meta">
            <div class="list-title">Juz ${r}</div>
            <div class="list-sub">Para ${r}</div>
          </div>
          <button data-action="play-selection" data-mode="juz" data-number="${r}">Play</button>
        </div>
      `}).join("")),Ne(t.bookmarks)}function Ne(t){const e=Pe(t);if(!e.length){l.bookmarkList.innerHTML='<p class="empty">No bookmarks yet.</p>';return}l.bookmarkList.innerHTML=e.map(a=>{const r=a.mode==="surah"?`Surah ${a.surahNumber} - Ayah ${a.ayahNumber}`:`Juz ${a.juzNumber??""} - ${a.surahNumber}:${a.ayahNumber}`;return`
        <button class="bookmark-item" data-action="bookmark-jump" data-mode="${a.mode}" data-surah="${a.surahNumber}" data-ayah="${a.ayahNumber}" data-juz="${a.juzNumber??""}">
          <span>${r}</span>
          <span class="bookmark-time">${qe(a.timestamp)}</span>
        </button>
      `}).join("")}function T(t){if(!t.verses.length){O(t),l.versesContainer.innerHTML='<p class="empty">Select a Surah or Juz to begin.</p>',$=-1,N=null,A=null,b=-1,v=-1,P=-1;return}O(t);const e=t.playbackState.currentIndex,a=[];let r=null;t.verses.forEach((s,i)=>{t.currentMode==="juz"&&r!==null&&s.surah!==r&&a.push(Ee(t,s.surah)),(r===null||s.surah!==r)&&(r=s.surah),a.push(Le(s,i,t,e))}),l.versesContainer.innerHTML=a.join(""),$=-1,N=null,A=null,b=-1,v=-1,P=-1}function Ae(t){O(t)}function M(t){const e=I.map(a=>{const r=a.id===t.settings.reciterId?"selected":"";return`<option value="${a.id}" ${r}>${a.name}</option>`}).join("");l.settingsContent.innerHTML=`
    <div class="settings-section">
      <h4>Audio</h4>
      <div class="settings-row">
        <label>Reciter</label>
        <select data-action="reciter-select">${e}</select>
      </div>
      <div class="settings-row">
        <label>Urdu translation</label>
        <span>${C}</span>
      </div>
      <div class="settings-row">
        <label>Voice</label>
        <span>${ce}</span>
      </div>
      <div class="settings-row">
        <label>Urdu Voice</label>
        <button class="toggle-switch ${t.settings.urduVoiceEnabled?"on":""}" data-action="toggle-urdu-voice" aria-pressed="${t.settings.urduVoiceEnabled}">
          <span class="toggle-dot"></span>
        </button>
      </div>
    </div>

    <div class="settings-section">
      <h4>Typography</h4>
      <div class="settings-row">
        <label>Arabic size</label>
        <div class="stepper">
          <button data-action="arabic-dec">-</button>
          <span>${t.settings.arabicFontPx}px</span>
          <button data-action="arabic-inc">+</button>
        </div>
      </div>
      <div class="settings-row">
        <label>Urdu size</label>
        <div class="stepper">
          <button data-action="urdu-dec">-</button>
          <span>${t.settings.urduFontPx}px</span>
          <button data-action="urdu-inc">+</button>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <h4>Theme</h4>
      <div class="settings-row">
        <label>Mode</label>
        <button class="toggle-pill" data-action="toggle-theme">${t.settings.theme==="warm"?"Warm":"Dark"}</button>
      </div>
    </div>
  `,t.settingsOpen?(l.settingsDrawer.classList.remove("hidden"),l.settingsOverlay.classList.remove("hidden")):(l.settingsDrawer.classList.add("hidden"),l.settingsOverlay.classList.add("hidden"))}function V(t){const e=t.playbackState.currentIndex,a=t.playbackState.phase,r=t.playbackState.status==="playing",s=A!==t.playbackState.status,i=$!==e,u=N!==a;if(!(!i&&!u&&!s)){if(i){const o=l.versesContainer.querySelector(`[data-verse-index="${$}"]`);o instanceof HTMLElement&&(o.classList.remove("active"),S(o),E(t,$));const d=l.versesContainer.querySelector(`[data-verse-index="${e}"]`);d instanceof HTMLElement&&(d.classList.add("active"),S(d),E(t,e)),$=e,b=-1,v=-1,P=e}else{const o=l.versesContainer.querySelector(`[data-verse-index="${e}"]`);o instanceof HTMLElement&&(u&&(S(o),b=-1,v=-1),s&&!r&&(S(o),E(t,e)),s&&r&&(S(o),b=-1,v=-1,E(t,e)))}N=a,A=t.playbackState.status,i&&r&&_e(e)}}function q(){const t=l.versesContainer.querySelector(".verse.active");t instanceof HTMLElement&&(t.classList.remove("active"),S(t)),$=-1,N=null,A=null,b=-1,v=-1,P=-1}function we(t,e){if(t.playbackState.status!=="playing")return;const a=e.currentIndex,r=l.versesContainer.querySelector(`[data-verse-index="${a}"]`);if(!(r instanceof HTMLElement))return;const s=Fe(r,e.phase);if(!s)return;const i=Number.isFinite(e.duration)&&e.duration>0?e.duration:0,u=i?Math.floor(e.currentTime/i*s):0,o=Math.min(Math.max(u,0),s-1);Be(r,e.phase,o,a)}function x(t){if(t.error){l.notice.innerHTML=`<div class="notice-banner error">${t.error}</div>`;return}l.notice.innerHTML=""}function Me(t){if(!t)return;const e=document.createElement("div");e.className="toast",e.textContent=t,l.toastHost.appendChild(e),window.setTimeout(()=>{e.classList.add("hide"),window.setTimeout(()=>e.remove(),300)},2200)}function Le(t,e,a,r){const s=e===r?"active":"",i=a.currentMode==="surah"?`Ayah ${t.ayah}`:`Ayah ${t.surah}:${t.ayah}`,u=Te(a.bookmarks,{mode:a.currentMode,surahNumber:t.surah,ayahNumber:t.ayah,juzNumber:a.currentMode==="juz"?a.currentSelection??void 0:void 0}),o=se(t.arabicText),d=se(t.urduText),c=`ayah-${re(t.surah)}${re(t.ayah)}`,p=!!(a.playbackState.isPlaying&&a.activeAyahKey===t.key),m=J(p?"stop":"play");return`
    <div class="verse ${s}" id="${c}" data-verse-index="${e}" data-ayah-key="${t.key}" data-arabic-words="${o.count}" data-urdu-words="${d.count}">
      <div class="verse-actions">
        <button class="icon-button" data-action="toggle-ayah-play" data-index="${e}" aria-label="${p?"Stop ayah":"Play ayah"}">
          ${m}
        </button>
        <button class="bookmark-button ${u?"active":""}" data-action="toggle-bookmark" data-index="${e}">
          ${u?"Bookmarked":"Bookmark"}
        </button>
      </div>
      <div class="verse-meta">
        <span>${i}</span>
        <span class="playing-indicator">Playing</span>
      </div>
      <div class="verse-arabic" dir="rtl" lang="ar">${o.html}</div>
      <div class="verse-urdu" dir="rtl" lang="ur">${d.html}</div>
    </div>
  `}function O(t){if(!t.verses.length){l.selectionHeader.innerHTML="";return}if(t.currentMode==="surah"){const s=t.chapters.find(p=>p.id===t.currentSelection),i=s?`Surah ${s.name_simple}`:`Surah ${t.currentSelection??""}`,u=s?`${s.verses_count} ayahs`:`${t.verses.length} ayahs`,o=!!(t.playbackState.isPlaying&&t.playbackScope==="surah"&&t.activeSurahNumber===t.currentSelection),d=o?"Stop":"Play",c=J(o?"stop":"play");l.selectionHeader.innerHTML=`
      <div class="selection-card">
        <div class="selection-row">
          <div>
            <h3>${i}</h3>
            <p>${u}</p>
          </div>
          <button class="header-toggle" data-action="toggle-surah-play" aria-label="${d} surah">
            ${c}
            <span>${d}</span>
          </button>
        </div>
      </div>
    `;return}const e=t.verses[0],a=t.verses[t.verses.length-1],r=e&&a?`${e.surah}:${e.ayah} – ${a.surah}:${a.ayah}`:"";l.selectionHeader.innerHTML=`
    <div class="selection-card">
      <h3>Juz ${t.currentSelection??""}</h3>
      <p>${r}</p>
    </div>
  `}function Ee(t,e){const a=t.chapters.find(i=>i.id===e),r=a?`Now entering Surah ${a.name_simple}`:`Now entering Surah ${e}`,s=a?`${a.verses_count} ayahs`:"";return`
    <div class="surah-separator">
      <div>${r}</div>
      <span>${s}</span>
    </div>
  `}function He(t){if(!t.verses.length)return"No selection";const e=t.verses[t.playbackState.currentIndex];if(!e)return"No selection";if(t.currentMode==="surah"){const a=t.chapters.find(r=>r.id===e.surah);return`${(a==null?void 0:a.name_simple)??`Surah ${e.surah}`} • Ayah ${e.ayah}`}return`Juz ${t.currentSelection??""} • ${e.surah}:${e.ayah}`}function J(t){return t==="stop"?`
      <svg class="icon" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
        <rect x="5" y="5" width="10" height="10" rx="2" />
      </svg>
    `:`
    <svg class="icon" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
      <polygon points="6,4 16,10 6,16" />
    </svg>
  `}function Ce(t){return Number(t)===1?"1x":`${t}x`}function E(t,e){if(e<0)return;const a=t.verses[e];if(!a)return;const r=l.versesContainer.querySelector(`[data-verse-index="${e}"]`);if(!(r instanceof HTMLElement))return;const s=r.querySelector('button[data-action="toggle-ayah-play"]');if(!(s instanceof HTMLButtonElement))return;const i=!!(t.playbackState.isPlaying&&t.activeAyahKey===a.key);s.innerHTML=J(i?"stop":"play"),s.setAttribute("aria-label",i?"Stop ayah":"Play ayah")}function _e(t){const e=l.versesContainer.querySelector(`[data-verse-index="${t}"]`);if(!(e instanceof HTMLElement))return;const a=l.versesContainer,r=a.scrollHeight>a.clientHeight+1,s=()=>{U=window.setTimeout(()=>{R=!1},600)};if(R=!0,U&&window.clearTimeout(U),r){const p=Math.round(a.clientHeight*.15),m=e.offsetTop-p;a.scrollTo({top:Math.max(m,0),behavior:"smooth"}),s();return}const i=document.body.classList.contains("player-visible")&&Number.parseInt(getComputedStyle(document.documentElement).getPropertyValue("--player-bar-height"),10)||0,u=Math.max(window.innerHeight-i,0),o=Math.round(u*.15),d=e.getBoundingClientRect(),c=window.scrollY+d.top-o;window.scrollTo({top:Math.max(c,0),behavior:"smooth"}),s()}function Be(t,e,a,r){if(P!==r&&(S(t),b=-1,v=-1,P=r),e==="arabic"){if(a===b)return;ae(t,".verse-arabic",b,a),b=a;return}if(e==="urdu"){if(a===v)return;ae(t,".verse-urdu",v,a),v=a}}function ae(t,e,a,r){const s=t.querySelector(e);if(!(s instanceof HTMLElement))return;if(a>=0){const u=s.querySelector(`[data-word-index="${a}"]`);u instanceof HTMLElement&&u.classList.remove("word-active")}const i=s.querySelector(`[data-word-index="${r}"]`);i instanceof HTMLElement&&i.classList.add("word-active")}function S(t){t.querySelectorAll(".word-active").forEach(a=>a.classList.remove("word-active"))}function Fe(t,e){const a=e==="arabic"?t.dataset.arabicWords:t.dataset.urduWords,r=a?Number.parseInt(a,10):0;return Number.isFinite(r)?r:0}function se(t){const e=t.split(/(\s+)/);let a=0;return{html:e.map(s=>{if(!s.trim())return s;const i=Ue(s),u=`<span class="word" data-word-index="${a}">${i}</span>`;return a+=1,u}).join(""),count:a}}function Ue(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")}function re(t){return String(t).padStart(3,"0")}function qe(t){try{return new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return""}}const H=new pe,h=new fe,K=new ve,n=Se({currentMode:"surah",currentSelection:null,verses:[],playbackState:h.getState(),settings:K.get(),bookmarks:$e(),chapters:[],translatorName:C,translationId:null,playbackScope:null,activeMode:null,activeSurahNumber:null,activeAyahKey:null,playerVisible:!0,settingsOpen:!1,speedMenuOpen:!1,loading:!0,error:""});function W(t,e){document.documentElement.style.setProperty("--arabic-size",`${t}px`),document.documentElement.style.setProperty("--urdu-size",`${e}px`)}function G(t){document.documentElement.dataset.theme=t}function Q(t){var e;return((e=I.find(a=>a.id===t))==null?void 0:e.baseUrl)??I[0].baseUrl}async function k(t,e,a,r=!1,s){r&&y(n.getState());const i=n.getState().translationId;if(!i){n.update(u=>({...u,error:"Urdu translation not found."})),x(n.getState());return}n.update(u=>({...u,loading:!0,error:""})),x(n.getState()),w(n.getState());try{let u=[];t==="surah"?u=await H.getVersesByChapter(e,i):u=await H.getVersesByJuz(e,i);const o=u.map(c=>{var X,Z;const[p,m]=c.verse_key.split(":"),L=Number(p),Y=Number(m);return{surah:L,ayah:Y,verseKey:c.verse_key,key:be(L,Y),arabicText:c.text_uthmani,urduText:ge(((Z=(X=c.translations)==null?void 0:X[0])==null?void 0:Z.text)??"")}}),d=a?Math.max(o.findIndex(c=>c.surah===a.surah&&c.ayah===a.ayah),0):0;if(n.update(c=>({...c,currentMode:t,currentSelection:e,verses:o,loading:!1,error:""})),h.loadPlaylist(o),h.setSources(Q(n.getState().settings.reciterId),D),r&&o.length){const c=o[d],p=s??(t==="surah"?"surah":"ayah");n.update(m=>({...m,playbackScope:p,activeMode:t,activeSurahNumber:(c==null?void 0:c.surah)??null,activeAyahKey:(c==null?void 0:c.key)??null})),h.playFromIndex(d)}}catch(u){const o=u instanceof Error?u.message:"Failed to load selection.";n.update(d=>({...d,loading:!1,error:o})),x(n.getState()),y(n.getState())}finally{w(n.getState()),T(n.getState()),V(n.getState())}}function f(t){const e=K.update(t);n.update(a=>({...a,settings:e})),W(e.arabicFontPx,e.urduFontPx),G(e.theme),h.setRepeat(e.repeat),h.setUrduVoiceEnabled(e.urduVoiceEnabled),h.setPlaybackRate(e.playbackSpeed),y(n.getState()),M(n.getState())}function ze(t){const e=t.target,a=e.closest("[data-action]"),r=a==null?void 0:a.dataset.action;if(r){if(r==="switch-mode"){const s=a==null?void 0:a.dataset.mode;s&&s!==n.getState().currentMode&&(n.update(i=>({...i,currentMode:s})),w(n.getState()));return}if(r==="select-selection"){const s=(a==null?void 0:a.dataset.mode)??"surah",i=Number(a==null?void 0:a.dataset.number);if(!Number.isFinite(i))return;h.stop(),y(n.getState()),k(s,i,void 0,!1);return}if(r==="play-selection"){const s=(a==null?void 0:a.dataset.mode)??"surah",i=Number(a==null?void 0:a.dataset.number);if(!Number.isFinite(i))return;k(s,i,void 0,!0,s==="surah"?"surah":"ayah");return}if(r==="play"){h.play();return}if(r==="pause"){h.pause();return}if(r==="stop"){h.stop(),n.update(s=>({...s,playbackScope:null,activeMode:null,activeSurahNumber:null,activeAyahKey:null})),q(),y(n.getState());return}if(r==="next-ayah"){h.next();return}if(r==="prev-ayah"){h.prev();return}if(r==="prev-surah"){const s=n.getState();if(s.currentMode==="surah"){const i=(s.currentSelection??1)-1;i>=1&&k("surah",i,void 0,!0);return}h.prevSurah();return}if(r==="next-surah"){const s=n.getState();if(s.currentMode==="surah"){const i=(s.currentSelection??1)+1;i<=s.chapters.length&&k("surah",i,void 0,!0);return}h.nextSurah();return}if(r==="toggle-repeat"){f({repeat:!n.getState().settings.repeat});return}if(r==="toggle-urdu-voice"){f({urduVoiceEnabled:!n.getState().settings.urduVoiceEnabled});return}if(r==="toggle-speed-menu"){n.update(s=>({...s,speedMenuOpen:!s.speedMenuOpen})),y(n.getState());return}if(r==="set-speed"){const s=Number(a==null?void 0:a.dataset.speed);if(!Number.isFinite(s))return;f({playbackSpeed:s}),n.update(i=>({...i,speedMenuOpen:!1})),y(n.getState());return}if(r==="arabic-inc"){f({arabicFontPx:Math.min(n.getState().settings.arabicFontPx+2,52)});return}if(r==="arabic-dec"){f({arabicFontPx:Math.max(n.getState().settings.arabicFontPx-2,24)});return}if(r==="urdu-inc"){f({urduFontPx:Math.min(n.getState().settings.urduFontPx+2,28)});return}if(r==="urdu-dec"){f({urduFontPx:Math.max(n.getState().settings.urduFontPx-2,14)});return}if(r==="toggle-ayah-play"){const s=Number(a==null?void 0:a.dataset.index);if(!Number.isFinite(s))return;const i=n.getState().verses[s];if(!i)return;if(n.getState().activeAyahKey===i.key&&n.getState().playbackState.isPlaying){h.stop(),n.update(o=>({...o,playbackScope:null,activeMode:null,activeSurahNumber:null,activeAyahKey:null})),q(),y(n.getState()),T(n.getState());return}h.stop(),h.loadPlaylist(n.getState().verses),h.setSources(Q(n.getState().settings.reciterId),D),h.playFromIndex(s),n.update(o=>({...o,playbackScope:"ayah",activeMode:o.currentMode,activeSurahNumber:i.surah,activeAyahKey:i.key})),y(n.getState()),T(n.getState());return}if(r==="toggle-bookmark"){const s=Number(a==null?void 0:a.dataset.index);if(!Number.isFinite(s))return;const i=n.getState().verses[s];if(!i)return;const u=n.getState().currentMode,o=ke(n.getState().bookmarks,{mode:u,surahNumber:i.surah,ayahNumber:i.ayah,juzNumber:u==="juz"?n.getState().currentSelection??void 0:void 0});xe(o),n.update(d=>({...d,bookmarks:o})),w(n.getState()),T(n.getState()),V(n.getState());return}if(r==="bookmark-jump"){const s=(a==null?void 0:a.dataset.mode)??"surah",i=Number(a==null?void 0:a.dataset.surah),u=Number(a==null?void 0:a.dataset.ayah),o=Number(a==null?void 0:a.dataset.juz);if(!Number.isFinite(i)||!Number.isFinite(u))return;const d=s==="surah"?i:o;if(!Number.isFinite(d))return;k(s,d,{surah:i,ayah:u},!0,"ayah");return}if(r==="toggle-surah-play"){const s=n.getState();if(s.currentMode!=="surah"||!s.currentSelection)return;if(!!(s.playbackState.isPlaying&&s.playbackScope==="surah"&&s.activeSurahNumber===s.currentSelection)){h.stop(),n.update(u=>({...u,playbackScope:null,activeMode:null,activeSurahNumber:null,activeAyahKey:null})),q(),y(n.getState()),T(n.getState()),x(n.getState());return}k("surah",s.currentSelection,void 0,!0,"surah");return}if(r==="toggle-settings"){n.update(s=>({...s,settingsOpen:!s.settingsOpen})),M(n.getState());return}if(r==="close-settings"){n.update(s=>({...s,settingsOpen:!1})),M(n.getState());return}if(r==="toggle-theme"){const s=n.getState().settings.theme==="warm"?"dark":"warm";f({theme:s});return}n.getState().speedMenuOpen&&!e.closest(".speed-control")&&(n.update(s=>({...s,speedMenuOpen:!1})),y(n.getState()))}}function Re(t){const e=t.target;if(!e)return;const a=e.dataset.action;if(a&&a==="reciter-select"){const r=e.value||j;f({reciterId:r}),h.setSources(Q(r),D),h.restartCurrent()}}async function Oe(){W(n.getState().settings.arabicFontPx,n.getState().settings.urduFontPx),G(n.getState().settings.theme),h.setRepeat(n.getState().settings.repeat),h.setUrduVoiceEnabled(n.getState().settings.urduVoiceEnabled),h.setPlaybackRate(n.getState().settings.playbackSpeed);const t=n.getState().settings.reciterId;I.some(e=>e.id===t)||f({reciterId:j});try{const[e,a]=await Promise.all([H.getChapters(),H.getTranslations()]),r=me(a);r.id&&localStorage.setItem(he,String(r.id)),n.update(s=>({...s,chapters:e,translatorName:C,translationId:r.id??null,loading:!1,error:r.id?"":"Urdu translation not found (Jalandhari)."})),x(n.getState())}catch(e){const a=e instanceof Error?e.message:"Failed to load Quran data.";n.update(r=>({...r,loading:!1,error:a})),x(n.getState())}finally{w(n.getState()),y(n.getState()),M(n.getState()),T(n.getState()),x(n.getState())}}h.subscribe(t=>{n.update(r=>({...r,playbackState:t}));const a=h.getQueue()[t.currentIndex];a&&(t.status==="playing"||t.status==="paused")&&n.update(r=>({...r,activeAyahKey:a.key,activeSurahNumber:a.surah,activeMode:r.activeMode??r.currentMode})),y(n.getState()),V(n.getState()),Ae(n.getState())});h.onNotice(t=>{Me(t)});h.onProgress(t=>{we(n.getState(),{phase:t.phase,currentIndex:t.currentIndex,currentTime:t.currentTime,duration:t.duration})});K.subscribe(t=>{n.update(e=>({...e,settings:t})),W(t.arabicFontPx,t.urduFontPx),G(t.theme),h.setRepeat(t.repeat),y(n.getState()),M(n.getState())});window.addEventListener("click",ze);window.addEventListener("change",Re);window.addEventListener("scroll",Ie,{passive:!0});window.addEventListener("beforeunload",()=>h.stop());Oe();
